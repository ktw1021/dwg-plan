<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DXF 도면 뷰어</title>
    <style>
        body {
            margin: 0;
            padding: 20px;
            background-color: #2c2c2c;
            font-family: Arial, sans-serif;
            color: white;
        }
        
        .container {
            max-width: 100%;
            height: 90vh;
            border: 1px solid #555;
            background-color: #000;
            overflow: auto;
            position: relative;
        }
        
        .controls {
            margin-bottom: 10px;
            padding: 10px;
            background-color: #404040;
            border-radius: 5px;
        }
        
        .controls button {
            background-color: #606060;
            border: none;
            color: white;
            padding: 8px 16px;
            margin: 0 5px;
            border-radius: 3px;
            cursor: pointer;
        }
        
        .controls button:hover {
            background-color: #707070;
        }
        
        .info {
            color: #ccc;
            font-size: 12px;
            margin-left: 10px;
        }
        
        #drawing {
            width: 100%;
            height: 100%;
            background-color: #000;
        }
        
        h1 {
            color: #fff;
            text-align: center;
            margin-bottom: 20px;
        }
    </style>
</head>
<body>
    <h1>DWG → DXF → SVG 변환 결과</h1>
    
    <div class="controls">
        <button onclick="zoomIn()">확대 (+)</button>
        <button onclick="zoomOut()">축소 (-)</button>
        <button onclick="resetView()">원본 크기</button>
        <button onclick="fitToWindow()">화면에 맞춤</button>
        <button onclick="autoFit()">자동 맞춤</button>
        <span class="info">마우스 휠로 확대/축소, 드래그로 이동 가능</span>
    </div>
    
    <div class="layer-controls" style="margin-bottom: 10px; padding: 10px; background-color: #404040; border-radius: 5px;">
        <label style="color: white; margin-right: 10px;">레이어 필터:</label>
        <button onclick="showAllLayers()">전체 표시</button>
        <button onclick="hideEmptyAreas()">빈 영역 숨기기</button>
        <div id="layerButtons" style="margin-top: 5px;"></div>
    </div>
    
    <div class="container">
        <div id="drawing"></div>
    </div>

    <script>
        let currentScale = 1;
        let isPanning = false;
        let panStart = {x: 0, y: 0};
        let panOffset = {x: 0, y: 0};
        
        // SVG 로드
        async function loadSVG() {
            try {
                // 가장 최근 SVG 파일 로드
                const response = await fetch('./results/b7cc3ed2-44dd-4f51-9ea1-eb95149f5ffa.svg');
                const svgContent = await response.text();
                
                const drawingDiv = document.getElementById('drawing');
                drawingDiv.innerHTML = svgContent;
                
                const svg = drawingDiv.querySelector('svg');
                if (svg) {
                    // SVG 스타일 조정
                    svg.style.width = '100%';
                    svg.style.height = '100%';
                    svg.style.display = 'block';
                    
                    // 마우스 이벤트 추가
                    svg.addEventListener('wheel', handleWheel);
                    svg.addEventListener('mousedown', startPan);
                    svg.addEventListener('mousemove', handlePan);
                    svg.addEventListener('mouseup', endPan);
                    svg.addEventListener('mouseleave', endPan);
                }
                
                console.log('SVG 로드 완료');
            } catch (error) {
                console.error('SVG 로드 실패:', error);
                document.getElementById('drawing').innerHTML = 
                    '<p style="color: red; text-align: center; padding: 50px;">SVG 파일을 로드할 수 없습니다.</p>';
            }
        }
        
        function zoomIn() {
            currentScale *= 1.2;
            updateTransform();
        }
        
        function zoomOut() {
            currentScale /= 1.2;
            updateTransform();
        }
        
        function resetView() {
            currentScale = 1;
            panOffset.x = 0;
            panOffset.y = 0;
            updateTransform();
        }
        
        function fitToWindow() {
            const svg = document.querySelector('#drawing svg');
            if (svg) {
                const container = document.querySelector('.container');
                const containerRect = container.getBoundingClientRect();
                const svgRect = svg.getBoundingClientRect();
                
                const scaleX = containerRect.width / svgRect.width;
                const scaleY = containerRect.height / svgRect.height;
                currentScale = Math.min(scaleX, scaleY) * 0.9;
                
                panOffset.x = 0;
                panOffset.y = 0;
                updateTransform();
            }
        }
        
        function updateTransform() {
            const svg = document.querySelector('#drawing svg');
            if (svg) {
                svg.style.transform = `scale(${currentScale}) translate(${panOffset.x}px, ${panOffset.y}px)`;
            }
        }
        
        function handleWheel(event) {
            event.preventDefault();
            const delta = event.deltaY > 0 ? 0.9 : 1.1;
            currentScale *= delta;
            updateTransform();
        }
        
        function startPan(event) {
            isPanning = true;
            panStart.x = event.clientX - panOffset.x;
            panStart.y = event.clientY - panOffset.y;
            event.preventDefault();
        }
        
        function handlePan(event) {
            if (!isPanning) return;
            
            panOffset.x = event.clientX - panStart.x;
            panOffset.y = event.clientY - panStart.y;
            updateTransform();
        }
        
        function endPan() {
            isPanning = false;
        }
        
        function autoFit() {
            const svg = document.querySelector('#drawing svg');
            if (!svg) return;
            
            // SVG 내부의 실제 요소들의 바운딩 박스 계산
            const elements = svg.querySelectorAll('line, polyline, circle, arc, rect, path');
            if (elements.length === 0) return;
            
            let minX = Infinity, minY = Infinity, maxX = -Infinity, maxY = -Infinity;
            
            elements.forEach(el => {
                const bbox = el.getBBox();
                minX = Math.min(minX, bbox.x);
                minY = Math.min(minY, bbox.y);
                maxX = Math.max(maxX, bbox.x + bbox.width);
                maxY = Math.max(maxY, bbox.y + bbox.height);
            });
            
            if (isFinite(minX) && isFinite(minY) && isFinite(maxX) && isFinite(maxY)) {
                const width = maxX - minX;
                const height = maxY - minY;
                const centerX = (minX + maxX) / 2;
                const centerY = (minY + maxY) / 2;
                
                // 새로운 viewBox 설정
                const padding = Math.max(width, height) * 0.1; // 10% 패딩
                svg.setAttribute('viewBox', 
                    `${minX - padding} ${minY - padding} ${width + 2*padding} ${height + 2*padding}`);
                    
                console.log(`자동 맞춤: viewBox="${minX - padding} ${minY - padding} ${width + 2*padding} ${height + 2*padding}"`);
            }
        }
        
        function showAllLayers() {
            const svg = document.querySelector('#drawing svg');
            if (!svg) return;
            
            const allElements = svg.querySelectorAll('*');
            allElements.forEach(el => {
                el.style.display = '';
            });
        }
        
        function hideEmptyAreas() {
            const svg = document.querySelector('#drawing svg');
            if (!svg) return;
            
            // 배경 제거
            const backgrounds = svg.querySelectorAll('.background, rect[fill="#000"]');
            backgrounds.forEach(bg => bg.style.display = 'none');
        }
        
        function toggleLayer(layerName) {
            const svg = document.querySelector('#drawing svg');
            if (!svg) return;
            
            // 레이어별 요소 토글 (이것은 간단한 예시입니다)
            const layerElements = svg.querySelectorAll(`[data-layer="${layerName}"]`);
            layerElements.forEach(el => {
                el.style.display = el.style.display === 'none' ? '' : 'none';
            });
        }
        
        // 페이지 로드 시 SVG 로드
        window.addEventListener('load', loadSVG);
    </script>
</body>
</html> 